@model GundamZoneProject.Models.EntityFrameWork.Coupon

@{
    ViewBag.Title = "Thêm mã giảm giá";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}
<link href="~/Assets/AdminCss/Coupon/create-coupon.css" rel="stylesheet" />
@section naviheader{
    <!-- Left navbar links -->
    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link" data-widget="pushmenu" href="#" role="button">
                <i class="fas fa-bars"></i>
            </a>
        </li>

        <li class="nav-item d-none d-sm-inline-block">
            <a href="/admin" class="nav-link">Trang chủ</a>
        </li>

        <li class="nav-item d-none d-sm-inline-block">
            <a href="/admin/coupon" class="nav-link">Mã giảm giá</a>
        </li>

        <li class="nav-item d-none d-sm-inline-block">
            <a href="#" class="nav-link">Thêm mới</a>
        </li>
    </ul>
}

<!-- Content Header -->
<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1>Thêm mới mã giảm giá</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="/admin/coupon">Mã giảm giá</a></li>
                    <li class="breadcrumb-item active">Thêm mới</li>
                </ol>
            </div>
        </div>
    </div>
</section>

<!-- Main Content -->
<section class="content">

    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Thông tin mã giảm giá</h3>
        </div>

        <div class="card-body">

            @using (Html.BeginForm("Create", "Coupon", FormMethod.Post))
            {
                @Html.AntiForgeryToken()
                @Html.ValidationSummary(true)

                <div class="form-group">
                    <label>Mã giảm giá</label>
                    @Html.TextBoxFor(x => x.Code, new { @class = "form-control", @placeholder = "VD: SALE20" })
                    @Html.ValidationMessageFor(x => x.Code, null, new { @class = "text-danger" })
                </div>

                <div class="form-group">
                    <label>Loại giảm</label>
                    @Html.DropDownListFor(
                        x => x.DiscountType,
                        new SelectList(new[]
                        {
                            new { Value = 1, Text = "Giảm theo %" },
                            new { Value = 2, Text = "Giảm theo số tiền" }
                        }, "Value", "Text"),
                        new { @class = "form-control" }
                    )
                </div>

                <div class="form-group">
                    <label>Mức giảm</label>
                    @Html.TextBoxFor(x => x.DiscountValue, new { @class = "form-control money-input", autocomplete = "off" })

                </div>

                <div class="form-group">
                    <label>Đơn hàng tối thiểu</label>
                    @Html.TextBoxFor(x => x.MinOrderValue, new { @class = "form-control money-input", autocomplete = "off" })

                </div>

                @*<div class="form-group">
                        <label>Số lượng mã</label>
                        @Html.TextBoxFor(x => x.Quantity, new { @class = "form-control", @Value = "1" })
                    </div>*@

                <div class="form-group">
                    <label>Ngày bắt đầu</label>
                    @Html.TextBoxFor(x => x.StartDate, "{0:yyyy-MM-dd}", new { @class = "form-control", type = "date" })
                </div>
                <div class="form-group">
                    <label>Ngày hết hạn</label>
                    @Html.TextBoxFor(x => x.EndDate, "{0:yyyy-MM-dd}", new { @class = "form-control", type = "date" })
                </div>

                <div class="form-group">
                    <label>Trạng thái</label>
                    @Html.CheckBoxFor(x => x.IsActive)
                    <span> Kích hoạt</span>
                </div>

                <div class="form-group">
                    <a href="/admin/coupon" class="btn btn-danger">Quay lại</a>
                    <button type="submit" class="btn btn-primary">Thêm mã</button>
                </div>
            }
        </div>

        <div class="card-footer"></div>
    </div>

</section>
@section scripts {
    <script>
        function formatMoneyInput(input) {
            let value = input.value.replace(/\D/g, ""); // bỏ ký tự không phải số

            if (value === "") {
                input.value = "";
                return;
            }

            input.value = Number(value).toLocaleString("vi-VN");
        }

        document.querySelectorAll('.money-input').forEach(function (input) {

            // Format khi load
            formatMoneyInput(input);

            // Format khi nhập
            input.addEventListener('keyup', function () {
                formatMoneyInput(this);
            });

            // Format khi paste/blur
            input.addEventListener('change', function () {
                formatMoneyInput(this);
            });

            // Trước khi submit → bỏ dấu chấm
            input.form?.addEventListener('submit', function () {
                input.value = input.value.replace(/\./g, "");
            });
        });
    </script>
}
